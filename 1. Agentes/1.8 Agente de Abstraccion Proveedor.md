# 1.8 Bibliotecas de Abstracción de Proveedores Estandarizadas (SPAL)

Este capítulo especial explicará los agentes que confiarán en proveedores para ejecutar un operación determinada. La mayoría de los Agente confían a librerías externas o rutinas que no son propiedad de los ingerieros que están desarrollando el sistema. Estas librerías externas pueden o no pueden seguir las mejores técnicas en términos de abstracción y pruebas.

El Estándar manda confiar sobre proveedores estandarizados para el diseño de sistemas y desarrollo. Estos proveedores estandarizados debe tener las siguientes características:

## 1.8.0 Extensibilidad

Las bibliotecas de abstracción de proveedores estandarizados deben ser extensibles para soportar más proveedores externos. Por ejemplo, una librería que soporta comunicaciones con una base de datos SQL Server, debe ser suficientemente extensible para soportar comunicarse con MongoDB o MariaDB o cualquier otro proveedor sin costes adicionales por parte del consumidor de esas librerías.

<div align=center>
    <img src="https://raw.githubusercontent.com/hassanhabib/The-Standard-Spanish/main/1.%20Agentes/Recursos/Agentes-1.8.0.png" />
</div>

### 1.8.0.0 Configurabilidad

Para que las bibliotecas estandarizadas sean utilizables con varios proveedores, deben permitir a los ingenieros configurarlas para apuntar a un proveedor particular, local o remoto. Por ejemplo, las bibliotecas de abstracción de proveedor se pueden configurar de la siguiente manera:

```csharp
public class AgenteAlmacenamiento
{
    private readonly IAbstraccionProveedor abstraccionProveedor;

    public AgenteAlmacenamiento()
    {
        this.abstraccionProveedor = new AbstraccionProveedor();
        
        this.abstraccionProveedor.Configura(proveedor => 
            proveedor.UsaSqlServer(cadenaDeConexion: ....));
    }
}
```

Otro ejemplo para usar con un proveedor diferente sería:

```csharp
public class AgenteAlmacenamiento
{
    private readonly IAbstraccionProveedor abstraccionProveedor;

    public AgenteAlmacenamiento()
    {
        this.abstraccionProveedor = new AbstraccionProveedor();
        
        this.abstraccionProveedor.Configura(proveedor =>
            proveedor.UsaMariaDb(cadenaDeConexion: ....));
    }
}
```

## 1.8.1 Distribuibilidad
Las bibliotecas de abstracción deben permitir que varios ingenieros publiquen sus propias extensiones de la biblioteca. La biblioteca no necesita tener implementaciones de todos los proveedores en un binario. En cambio, estas bibliotecas deben proporcionar una interfaz o un contrato que todas las demás extensiones deben implementar para admitir un cierto proveedor.

Por ejemplo, supongamos que tenemos el contrato normalizado principal `Standard.Storages.Core`. Podemos publicar una biblioteca `Standard.Storages.Sql`. Cualquier otra persona también puede publicar `Standard.Storages.MongoDb` para admitir la misma interfaz. Una interfaz se vería algo así:

```csharp
public interface IProveedorAlmacenamiento
{
    ValueTask<T> Inserta(T @object);
    IQueryable<T> SeleccionaTodos();
    ...
    ...
    void Configura(Opciones opciones);
}
```
Este contrato de capacidades debe ser el mínimo que cualquier proveedor debe ser capaz de proporcionar. Sin embargo, las opciones adicionales en la extensión de proveedor pueden exponer más capacidades que pueden o no existir en otras bibliotecas.

## 1.8.2 Mockabilidad Externa (Cloud-Foreign)
Las bibliotecas de proveedores normalizadas deben permitir comunicaciones con APIs fantasma locales simuladas. Por ejemplo, si un sistema requiere una comunicación con una cola o un bus de eventos en la nube, la biblioteca de proveedor que abstrae esa tecnología debe permitir una conexión local para las pruebas de aceptación y las ejecuciones en modo avión, que mencionamos anteriormente como el principio de Cloud Foriegn.

La mockabilidad externa puede depender de otras bibliotecas externas que implementen patrones como PACT para crear una instancia de API externa fantasma o falsa que se ejecuta en la máquina local o en la red. Aquí hay un ejemplo:


```csharp
public class AgenteEvento
{
    private readonly IEventoProveedorAbstracto eventoProveedorAbstracto;

    public AgenteEvento(IConfiguration configuracion)
    {
        this.eventoProveedorAbstracto = 
            new EventoProveedorAbstracto(
                configuracion.Conexion,
                configuracion.TipoServidorDestino);
    }
}
```
En el fragmento anterior, el tipo de servidor objetivo `TipoServidorDestino` puede ser `Remoto` o `Local` como opciones obligatorias, pero los ingenieros que desarrollan la biblioteca pueden agregar otras opciones si así lo desean.

Las bibliotecas de proveedores abstractas deben imitar el mismo comportamiento exacto de sus proveedores. Por ejemplo, en un escenario de escucha de cola, estas bibliotecas deben exponer una API que admita eventos para los mensajes entrantes, incluso si estos mensajes son locales y no provienen de ningún servicio externo, como la nube.

También es aceptable tener la opción de admitir redes intranet y redes gobernadas que no están conectadas a Internet público en ciertos escenarios mediante el uso de estas mismas bibliotecas.

Las bibliotecas de abstracción de proveedores estandarizadas son sub-sistemas que también requieren tener sus propios corredores, servicios y capas de exposición de acuerdo con The Standard. Estas bibliotecas simplificarán aún más el desarrollo de los sistemas orientados al cliente con excepciones bien definidas para manejar, expectativas y también modificaciones más simples, ya que son de código abierto y cumplen con El Estándar.

## 1.8.3 Local a Global
Los ingenieros pueden desarrollar sus propias bibliotecas de abstracción de proveedores locales en la misma solución, suponiendo que no puedan encontrar un esfuerzo existente para satisfacer sus necesidades. Al hacerlo, se anima a estos ingenieros a hacer código abierto y publicar ese proyecto de abstracción para apoyar a otros ingenieros en la Comunidad El Estándar que puedan tener las mismas necesidades.

Esta práctica fomenta a los ingenieros en todas partes a crear un esfuerzo colectivo y un patrón de mente en colmena para resolver un problema una vez y compartirlo con el resto de la Comunidad de Ingeniería The Standard para una mayor mejora y apoyo.

Los sistemas de borde conformes a los estándares (dirigidos a los clientes) ya no deben agregar bibliotecas que no sean compatibles con los estándares a sus APIs, aplicaciones de escritorio o web u otros sistemas.
